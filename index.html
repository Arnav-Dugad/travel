<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Travel Globe</title>
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.114/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.114/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        html, body, #cesiumContainer { width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden; background: #000; }
        .hud-panel {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
        }
    </style>
</head>
<body>

    <div id="cesiumContainer"></div>

    <div class="absolute top-5 left-5 z-10 w-80 text-white">
        <div class="hud-panel p-6 rounded-lg">
            <h1 class="text-2xl font-bold tracking-widest uppercase mb-2 text-cyan-400">Mission Log</h1>
            <div class="space-y-4 text-sm font-mono">
                <div class="flex justify-between border-b border-gray-700 pb-2">
                    <span class="text-gray-400">STATUS</span>
                    <span class="text-green-400 font-bold">ONLINE</span>
                </div>
                <button onclick="flyHome()" class="w-full py-2 mt-4 bg-cyan-600 hover:bg-cyan-500 rounded font-bold transition">
                    RESET VIEW
                </button>
            </div>
        </div>
    </div>

    <script>
        // 1. SAFE CONFIGURATION
        // We use OpenStreetMap (OSM) because it is free and doesn't require the token to be perfect.
        Cesium.Ion.defaultAccessToken = 'YOUR_TOKEN_HERE'; // Keep this if you want terrain later

        async function initGlobe() {
            try {
                // Initialize Viewer
                const viewer = new Cesium.Viewer('cesiumContainer', {
                    // Turn off Terrain temporarily to ensure map loads first
                    // terrainProvider: await Cesium.createWorldTerrainAsync(), 
                    imageryProvider: new Cesium.UrlTemplateImageryProvider({
                        url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
                        subdomains: ['a', 'b', 'c']
                    }),
                    baseLayerPicker: false,
                    geocoder: false,
                    homeButton: false,
                    infoBox: false,
                    sceneModePicker: false,
                    navigationHelpButton: false,
                    animation: false,
                    timeline: false,
                    fullscreenButton: false
                });

                // Hide Credits
                viewer.cesiumWidget.creditContainer.style.display = "none";
                
                // Enable Sun Lighting
                viewer.scene.globe.enableLighting = true;

                /* --- CLOUD DEBUGGING ---
                1. If the map works now, UNCOMMENT this section below.
                2. If it turns white again, your 'clouds.png' path is wrong.
                */
                
                /*
                const earthRadius = 6371000.0;
                const cloudHeight = 15000.0;
                viewer.entities.add({
                    name: "Clouds",
                    position: Cesium.Cartesian3.ZERO,
                    orientation: new Cesium.CallbackProperty((time, result) => {
                        const spin = Cesium.Math.toRadians(time.secondsOfDay * 0.02);
                        return Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z, -spin);
                    }, false),
                    ellipsoid: {
                        radii: new Cesium.Cartesian3(earthRadius + cloudHeight, earthRadius + cloudHeight, earthRadius + cloudHeight),
                        material: new Cesium.ImageMaterialProperty({
                            image: 'clouds.png', // <--- CHECK THIS FILE NAME CAREFULLY
                            transparent: true,
                            alpha: 0.6
                        })
                    }
                });
                */

                // Corrected Trip Function (Longitude first!)
                function addTrip(startLng, startLat, endLng, endLat) {
                    const start = Cesium.Cartesian3.fromDegrees(startLng, startLat);
                    const end = Cesium.Cartesian3.fromDegrees(endLng, endLat);

                    // Flight Path
                    viewer.entities.add({
                        polyline: {
                            positions: [start, end],
                            width: 3,
                            material: new Cesium.PolylineGlowMaterialProperty({
                                glowPower: 0.2,
                                color: Cesium.Color.CYAN
                            })
                        }
                    });

                    // City Marker (Dot)
                    viewer.entities.add({
                        position: end,
                        point: { pixelSize: 8, color: Cesium.Color.RED }
                    });
                }

                // Add Test Trip: NYC (-74) to London (-0.12)
                addTrip(-74.0060, 40.7128, -0.1276, 51.5074);

                // Make viewer global so buttons work
                window.viewer = viewer;
                window.flyHome = function() {
                    viewer.camera.flyTo({
                        destination: Cesium.Cartesian3.fromDegrees(-0.12, 51.50, 20000000)
                    });
                };

            } catch (error) {
                console.error("Map Error:", error);
                alert("Map Error: " + error);
            }
        }

        initGlobe();
    </script>
</body>
</html>
